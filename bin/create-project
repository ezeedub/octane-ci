#!/usr/bin/env bash
## First-time project-creation
##
## This script is intended to be run once when initializing a new project
## from Octane.
##
## After project creation this command should be removed.

# Re-declared here since this is run outside the container.
INFO_SLUG="\033[33m[INFO]\033[0m"

set -e

fin project start

# Remove Octane's composer.lock file.
rm -rf composer.lock

# Install latest Particle theme.
if [ ! -e "${THEME_PATH}" ]; then
  printf "${INFO_SLUG} Downloading and installing Particle...\n"
  fin exec npx phase2/create-particle ${THEME_PATH}
  # @TODO: Remove this once Particle removes Husky.
  # Need to remove the default git hooks added by Husky from Particle.
  # They interfere with project hooks and with Drupal config import/export.
  rm -rf .git/hooks
fi

# Initial build of site.
printf "$INFO_SLUG Building site...\n"
./bin/init

printf "${INFO_SLUG} the \`bin/create-project\` script can now be removed.\n"
